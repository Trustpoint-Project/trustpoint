{% load i18n %}

{% block table_filter %}
  <div class="mb-3">
    <div class="card-body pb-0">
      <button
        class="btn btn-sm btn-outline-secondary mb-1"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#filterCollapse"
        aria-expanded="{% if request.GET %}true{% else %}false{% endif %}"
        aria-controls="filterCollapse">
        {% trans 'Filters' %}
      </button>
    </div>

    <div class="collapse{% if request.GET %} show{% endif %}" id="filterCollapse">
      <div class="card-body pt-2">
        <form method="get">

          <!-- Row 1: Device | Domain | Protocol | Workflow -->
          <div class="row g-3 align-items-end">
            <div class="col-12 col-md-4">
              <label for="{{ filter.form.device_name.id_for_label }}" class="form-label">
                {{ filter.form.device_name.label }}
              </label>
              {{ filter.form.device_name }}
            </div>

            <div class="col-12 col-md-3">
              <label for="{{ filter.form.domain.id_for_label }}" class="form-label">
                {{ filter.form.domain.label }}
              </label>
              {{ filter.form.domain }}
            </div>

            <div class="col-12 col-md-2">
              <label for="{{ filter.form.protocol.id_for_label }}" class="form-label">
                {{ filter.form.protocol.label }}
              </label>
              {{ filter.form.protocol }}
            </div>

            <div class="col-12 col-md-3">
              <label for="{{ filter.form.workflow.id_for_label }}" class="form-label">
                {{ filter.form.workflow.label }}
              </label>
              {{ filter.form.workflow }}
            </div>
          </div>

          <!-- Row 2: State | Checkboxes | Requested between (single column) -->
          <div class="row g-3 align-items-end mt-1">
            <div class="col-12 col-md-2">
              <label for="{{ filter.form.state.id_for_label }}" class="form-label">
                {{ filter.form.state.label }}
              </label>
              {{ filter.form.state }}
            </div>

            <!-- Stack both checkboxes vertically -->
            <div class="col-12 col-md-2">
              <div class="form-check mt-4">
                {{ filter.form.include_failed_rejected_parents }}
                <label class="form-check-label" for="{{ filter.form.include_failed_rejected_parents.id_for_label }}">
                  {{ filter.form.include_failed_rejected_parents.label }}
                </label>
              </div>

              <div class="form-check mt-2">
                {{ filter.form.include_finalized }}
                <label class="form-check-label" for="{{ filter.form.include_finalized.id_for_label }}">
                  {{ filter.form.include_finalized.label }}
                </label>
              </div>
            </div>

            <!-- Requested between: both fields stacked in one column -->
            <div class="col-12 col-md-2">
              <label class="form-label d-block">
                {% trans 'Requested between' %}
              </label>
              <div class="mb-2">
                {{ filter.form.requested_from }}
              </div>
              {{ filter.form.requested_to }}
            </div>
          </div>

          <!-- Buttons below -->
          <div class="mt-3 text-start">
            <button type="submit" class="btn btn-sm btn-primary me-2">
              {% trans 'Apply' %}
            </button>
            <a href="{% url table_url %}" class="btn btn-sm btn-outline-secondary">
              {% trans 'Reset' %}
            </a>
          </div>

        </form>
      </div>
    </div>
  </div>
{% endblock table_filter %}
