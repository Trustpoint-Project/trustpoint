{% extends 'trustpoint/base.html' %}
{% load i18n %}
{% load static %}
{% load crispy_forms_filters %}

{% block head %}
    <script src="{% static 'js/copy_clipboard.js' %}"></script>
{% endblock head %}

{% block content %}

    <form method="POST" autocomplete="off">
        {% csrf_token %}

        <div class="card">
            <div class="card-header">
                <div>
                    <h1>{% trans 'Help - Application Certificates - EST Domain Credential Authentication' %}</h1>
                </div>
            </div>
            <div class="card-body">
                <div class="tp-card-centered-content">
                    <h2>{% trans 'Summary' %}</h2>
                    <hr>
                    <ul class="tp-kvp-list">
                        <li>
                            <div>{% trans 'TLS-Client Certificate Request URL' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    https://{{ host }}/.well-known/est/simpleenroll/{{ device.domain }}/tlsclient/
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                        <li>
                            <div>{% trans 'TLS-Server Certificate Request URL' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    https://{{ host }}/.well-known/est/simpleenroll/{{ device.domain }}/tlsserver/
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>

                        </li>
                        <li>
                            <div>{% trans 'EST Username' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    {{ device.est_username }}
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                        <li>
                            <div>{% trans 'EST Password' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    {{ device.est_password }}
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                        <li>
                            <div>{% trans 'Key Identifier (KID)' %}</div>
                            <div>{{ device.id }}</div>
                        </li>
                        <li>
                            <div>{% trans 'Required Public Key Type' %}</div>
                            <div>{{ device.public_key_info }}</div>
                        </li>

                    </ul>
                    <hr>

                    <h2 class="mt-5">{% trans 'OpenSSL 3.x Commands' %}</h2>
                    <hr>

                    <ul class="tp-kvp-list">
                        <li>
                            <h3 class="mt-5">{% trans 'Key-Pair Generation' %}</h3>
                            <hr>
                            <div>{% trans 'OpenSSL Command' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    {{ key_gen_command }}
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    </ul>

                    <ul class="tp-kvp-list">

                        <li>
                            <h2 class="mt-5">{% trans 'TLS-Client CSR Generation' %}</h2>
                            <hr>
                            <div>{% trans 'OpenSSL Command' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    openssl req \<br>
                                    -new \<br>
                                    -key key.pem \<br>
                                    -outform der \<br>
                                    -out my_csr.der \<br>
                                    -subj "/CN={{ tls_client_cn }}"
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>

                            </div>
                        </li>
                        <li>
                            <h3 class="mt-3">{% trans 'Mutable Parameters' %}</h3>
                            <hr>
                            <div>{% trans 'Common Name' %}</div>
                            <div>{{ tls_client_cn }}</div>
                        </li>
                    </ul>
                    <ul class="tp-kvp-list">
                        <li>
                            <h2 class="mt-5">{% trans 'TLS-Server CSR Generation' %}</h2>
                            <hr>
                            <div>{% trans 'OpenSSL Command' %}</div>
                       
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    openssl req \<br>
                                    -new \<br>
                                    -key key.pem \<br>
                                    -outform der \<br>
                                    -out my_csr.der \<br>
                                    -subj "CN=/{{ tls_server_cn }}"
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>

                            </div>
                        </li>
                        <li>
                            <h3 class="mt-3">{% trans 'Mutable Parameters' %}</h3>
                            <hr>
                            <div>{% trans 'Common Name' %}</div>
                            <div>-sub "/CN={{ tls_server_cn }}"</div>
                        </li>

                    </ul>

                    <hr>

                    <h2 class="mt-5">{% trans 'Download or Copy the Trustpoint TLS Server Certificate' %}</h2>
                    <hr>
                    <ul class="tp-kvp-list">
                        <li>
                            <div>{% trans 'Download TLS Server Certificate' %}</div>
                            <div>
                                <a class="btn btn-primary min-width-15 mb-3" href="{% url 'pki:trustpoint-tls-server-download' %}">Download Server Certificate</a>
                            </div>
                        </li>
                        <li>
                            <div>
                                {% trans 'TLS Server Certificate in PEM format. You can copy this and paste it into a new file named server_cert.pem' %}
                            </div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    {{ trustpoint_server_certificate|linebreaksbr }}
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    </ul>

                    <h2 class="mt-5">{% trans 'curl Commands' %}</h2>
                    <hr>
                    <ul class="tp-kvp-list">
                        <li>
                            <h3 class="mt-5">{% trans 'TLS Client' %}</h3>
                            <hr>
                            <div>{% trans 'curl Command' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    curl --cert domain_credential_cert.pem --key domain_credential_key.pem \ \<br>
                                     --cacert server_cert.pem \<br>
                                     --header "Content-Type: application/pkcs10" \<br>
                                     --data-binary "@my_csr.der" \<br>
                                     -o certificate.der \<br>
                                     https://{{ host }}/.well-known/est/simpleenroll/{{ device.domain }}/tlsclient/
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    </ul>
                    <ul class="tp-kvp-list">
                        <li>
                            <h3 class="mt-5">{% trans 'TLS Server' %}</h3>
                            <hr>
                            <div>{% trans 'curl Command' %}</div>
                            <div class="copy-container" style="position: relative;">
                                <code class="command-text language-bash">
                                    curl --user "{{ device.est_username }}:{{ device.est_password }}" \<br>
                                     --cacert server_cert.pem \<br>
                                     --header "Content-Type: application/pkcs10" \<br>
                                     --data-binary "@my_csr.der" \<br>
                                     -o certificate.der \<br>
                                     https://{{ host }}/.well-known/est/simpleenroll/{{ device.domain }}/tlsserver/
                                </code>

                                <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard">
                                    <svg class="icon icon-copy" width="40" height="40" fill="currentColor">
                                        <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    </ul>



                </div>

            </div>
            <div class="card-footer">
                <div class="tp-card-btn-footer">
                    <a href="{% url 'devices:devices' %}" class="btn btn-secondary">{% trans "Back" %}</a>
                    <a href="{% url 'devices:certificate_lifecycle_management' pk=device.pk %}" class="btn btn-primary">{% trans "Certificate Lifecycle Management Summary" %}</a>
                </div>
            </div>
        </div>
    </form>

{% endblock content %}