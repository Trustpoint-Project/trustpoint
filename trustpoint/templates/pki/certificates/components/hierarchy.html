{% load i18n %}
{% block certificate_hierarchy %}
    <h2>{% trans 'Certificate Hierarchy' %}</h2>
    <hr class="hr-m">

    <div class="tp-kvp-list">
        <div>
            <div>{% trans 'Issuer' %}</div>
            <div>
                <style>
                .issuer-table {
                    border-collapse: collapse;
                    margin-top: 6px;
                    margin-bottom: 12px;
                }
                .issuer-table td {
                    padding: 2px 18px 2px 0;
                    text-align: left;
                    vertical-align: top;
                    border: none;
                }
                .issuer-table td:first-child {
                    min-width: 140px;
                    max-width: 220px;
                }
                .issuer-table td:nth-child(2) {
                    min-width: 115px;
                    color: #b0b0b0;
                }
                .issuer-table td:last-child {
                    min-width: 100px;
                }
                </style>
                <table class="issuer-table">
                  {% for entry in issuer_entries %}
                  <tr>
                      {% if entry.name %}
                        <td><strong>{{ entry.name }}</strong></td>
                        <td>({{ entry.oid }})</td>
                      {% else %}
                        <td></td>
                        <td>{{ entry.oid }}</td>
                      {% endif %}
                      <td>
                        {% if forloop.first and not cert.is_self_signed and cert.issuer_id %}
                          <a href="{% url 'pki:certificate-detail' pk=cert.issuer_id.id %}" class="btn-primary">{{ entry.value }}</a>
                        {% else %}
                          <span class="btn-primary">{{ entry.value }}</span>
                        {% endif %}
                      </td>
                  </tr>
                  {% endfor %}
                </table>
            </div>
        </div>

        <div>
            <div>{% trans 'End-Entity Certificate' %}</div>
            <div>{{ cert.is_end_entity }}</div>
        </div>

        <div>
            <div>{% trans 'Certificate Authority (CA)' %}</div>
            <div>{{ cert.is_ca }}</div>
        </div>

        <div>
            <div>{% trans 'Root Certificate Authority (CA)' %}</div>
            <div>{{ cert.is_root_ca }}</div>
        </div>

        <div>
            <div>{% trans 'Self-Signed' %}</div>
            <div>{{ cert.is_self_signed }}</div>
        </div>

        <div class="tp-row-br">
            <div>{% trans 'Certificate Chain' %}</div>
            <div>
                {% for certificate in cert.get_certificate_chain %}
                    <a href="{% url 'pki:certificate-detail' pk=certificate.id %}">
                        {% if certificate.common_name %}
                            {{ certificate.common_name }}
                        {% else %}
                            Serial Number {{ certificate.serial_number }}
                        {% endif %}
                    </a><br>
                {% empty %}
                    {% if cert.is_self_signed %}
                        {% trans 'This is a self-signed certificate.' %}
                    {% else %}
                        {% trans 'No parent certificates in database.' %}
                    {% endif %}
                {% endfor %}
                <br>
            </div>
        </div>

        {% if cert.issued_certificate_references.all %}
            <div>
                <div>{% trans 'Number of Issued Certificates' %}</div>
                <div>
                    {{ cert.issued_certificate_references.count }}
                    <br>
                    <a href="{% url 'pki:issued_certificates' pk=cert.id %}" class="btn btn-primary my-1">
                        {% trans 'Show all issued certificates' %}
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock certificate_hierarchy %}