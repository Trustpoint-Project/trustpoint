{% extends 'trustpoint/base.html' %}
{% load i18n %}
{% load static %}

{% block head %}
    <script src="{% static 'js/copy_clipboard.js' %}"></script>
{% endblock head %}

{% block content %}
<div class="card" style="max-height: 100%; display: flex; flex-direction: column;">
    <div class="card-header">
        <h1>{% trans "Signed Messages for" %} {{ signer.unique_name }}</h1>
    </div>

    <div class="card-body text-start" style="overflow-y: auto; flex-grow: 1; max-height: 90%;">
        <table class="table">
            <thead>
            <tr>
                <th>{% trans "Hash Value" %}</th>
                <th>{% trans "Signature" %}</th>
                <th>{% trans "Created At" %}</th>
            </tr>
            </thead>
            <tbody>
                {% for message in signed_messages %}
                    <tr>
                        <td style="max-width: 300px; word-break: break-all; font-family: monospace; font-size: 0.9em;">
                            {{ message.hash_value }}
                        </td>
                        <td style="max-width: 300px; word-break: break-all; font-family: monospace; font-size: 0.9em;">
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#signatureModal{{ message.pk }}" style="cursor: pointer;">
                                {{ message.signature|truncatechars:50 }}
                            </a>
                        </td>
                        <td>{{ message.created_at|date:"Y-m-d H:i:s" }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">{% trans "No signed messages found" %}</td>
                    </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card-footer d-flex justify-content-between tp-sticky-footer">
        <div class="tp-card-btn-footer m-1">
            <a href="{% url 'signer:signer-config' signer.pk %}" class="btn btn-secondary">{% trans "Back to Signer" %}</a>
        </div>
    </div>
</div>

<!-- Modals for each signature -->
{% for message in signed_messages %}
<div class="modal fade" id="signatureModal{{ message.pk }}" tabindex="-1" aria-labelledby="signatureModalLabel{{ message.pk }}" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="signatureModalLabel{{ message.pk }}">{% trans "Signature Details" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>{% trans "Hash Value" %}</h6>
                <div class="copy-container mb-3" style="position: relative;">
                    <code class="command-text language-bash d-block p-2 rounded" style="word-break: break-all; font-size: 0.85em;">{{ message.hash_value }}</code>
                    <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard" style="position: absolute; top: 5px; right: 5px;">
                        <svg class="icon icon-copy" width="24" height="24" fill="currentColor">
                            <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                        </svg>
                    </button>
                </div>
                
                <h6>{% trans "Signature (Hexadecimal)" %}</h6>
                <div class="copy-container" style="position: relative;">
                    <code class="command-text language-bash d-block p-2 rounded" style="word-break: break-all; font-size: 0.85em;">{{ message.signature }}</code>
                    <button type="button" class="copy-button" data-tooltip="Copy to clipboard" aria-label="Copy to clipboard" style="position: absolute; top: 5px; right: 5px;">
                        <svg class="icon icon-copy" width="24" height="24" fill="currentColor">
                            <use href="{% static 'img/icons.svg' %}#icon-copy"></use>
                        </svg>
                    </button>
                </div>

                <div class="mt-3">
                    <small class="text-muted">
                        <strong>{% trans "Created" %}:</strong> {{ message.created_at|date:"Y-m-d H:i:s" }}
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% endblock content %}
