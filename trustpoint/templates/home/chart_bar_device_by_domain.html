<div class="card rounded-5 position-relative bar-chart-card-container">
  <div class="card-body">
    <h6 class="mb-3 fs-5">Onboarded Devices by Domain</h6>

    <div class="position-relative bar-chart-container">
      <canvas id="chart_device_by_domain" class="bar-chart-canvas"></canvas>
    </div>

    <div id="chart_device_by_domain_legend" class="mt-3 bar-chart-legend"></div>
  </div>
</div>

<script>
document.addEventListener('dashboardData', (event) => {
  const today = event.detail.today || {};

  const raw = today.device_counts_by_domain || [];

  const allItems = raw
    .map((row) => ({
      label: row.domain_name,
      value: row.onboarded_device_count
    }))
    .sort((a, b) => b.value - a.value);

  if (!allItems.length) return;

  const labels = allItems.map(i => i.label);
  const values = allItems.map(i => i.value);

  if (allItems.length) {
    createHorizontalBarChart(
      labels,
      values,
      'chart_device_by_domain',
      'chart_device_by_domain_legend',
      'deviceByDomain'
    );
  }

});
</script>

